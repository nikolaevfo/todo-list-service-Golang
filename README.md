# Todo-list - сервис на Go

### В процессе работы использованы:

- REST API
- Postgres

### Применены следующие пакеты:

gin - http фреймворк (работает быстрее стандартного net/http, позволяет создавать динамические маршруты).
viper - для работы с файлам конфигурации (папка config)
sqlx - библиотека для работы с БД
godotenv - для использования переменных окружения
logrus - библиотека для логирования
sha1 - библиотека для хэширования

### Функционал проекта:

- регистрация и авторизация
- создание, редактирование, получение и удаление списков и задач

### Структура прокета:

В папке cmd находиться основной main.go файл.
В папке pkg - вся логика приложения.

На верхнем уровне храняться сущности (слой структуры данных):
server.go - со структурой http сервера.
user.go - файл с описанием структур пользователя
todo.go - файл с описанием структур листов, задач и их списков, а так же структур для их обновления

В pkg находятся три папки для сответствующих модулей:
handler - отвечает за роутинг, описывает endpoints, подключает соответствующие обработчики для них. Это транспортный слой, слой работы с http.
-->
service - для бизнес логики, прописаны функции
-->
repository - для работы с БД

При разработке использован метод "Чистой архитектуры от Дяди Боба" (https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html). Это позволяет: сделать систему гибкой и масштабируемой, независимо тестировать каждый слой системы, не зависить от реализации пользовательского интерфейса, сделать бизнес логику независящей от технических решенией.
Мы можем в любой момент заменить базу данных на другую, и это никак не отразиться на остальной логике приложения
Основная задачи при таком методе - достич разделения ответственности. Для этого применяется правило зависимости: "зависимости могут быть направлены только внутрь, более глубокая структура ничего не должна знать о более внешней".
В нашем случае самая внешняя структура - база данных. Следующий слой - адаптер интерфейсов, служит для преобразования данных для работы внутренней бизнес-логики. Дальше - слой бизнес логики. Последний слой - сущности, это структуры данных и функции.
Используем технику внедрения зависимостей.
Нельзя создавать объекты внутри конструкторов. Для этого принимаем экземпляр объекта в конструкторе и присваиваем его полю в структуре (как в auth_postgres на 17 строке). Это позволит использовать разные объекты в качестве аргумента.
Коммуникации между слоями происходят с помощью интерфейсов в repository и service, а также структур, реализующих их.

### Работа базой данных:

Для запуска базы данных используется готовый docker-образ Postgres.
Всего 5 таблиц: пользователи, списки задач, задачи, а также 2 дополнительные для связи между основными: список пользователей, список задач.
При запуске приложения с помощью docker-compose происходит миграция (переход к новой структуре базы данных) с помощью файлов из папки schema и docker-образа migrate.
При запуске приложения локально с помощью go run cmd/main.go необходимо:

- скачать образ Postgres, если он еще не скачан:
  docker pull postgres
- запустить контейнер с БД командой:
  docker run --name=todo-db -e POSTGRES_PASSWORD='111111' -p 5432:5432 -d --rm postgres
  где мы указываем имя контейнера и пароль для доступа к БД, прокидываем порт, на котором будет доступна БД, флаг -d говорит о запуске контейнера в фоновом режиме, --rm - удалит контейнер после его остановки
- осуществить миграцию (должна быть установлена утилита migrate):
  migrate -path ./schema -database 'postgres://postgres:111111@localhost:5432/postgres?sslmode=disable' up

### Развёртывание:
